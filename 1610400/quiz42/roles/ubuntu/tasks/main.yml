---
# tasks file for ubuntu
 name: Get package of grafana
 apt:
   deb: https://dl.grafana.com/oss/release/grafana_7.3.6_amd64.deb
   register: pkg_grafana


 name: Depackage grafana
 dpkg_selections:
   name: grafana_7.3.6_amd64.deb
   selection: install
 when: pkg_grafana.changed


 name: Install libfontconfig
 apt:
   name: libfontconfig1
   state: latest
   update_cache: yes


 name: Install grafana
 apt:
   name: grafana
   state: latest
   update_cache: yes


 name: Start grafana
 service:
   name: grafana-server
   state: started


 name: Install prometheus
 apt:
   name: prometheus
   state: latest
   update_cache: yes

 name: start prometheus
 service:
   name: prometheus
   state: started


 name: Add influxdata key
 apt_key:
   url: https://repos.influxdata.com/influxdb.key
   state: present


 name: Add influxdata repository
 apt_repository:
   repo: 'deb https://repos.influxdata.com/ubunu focal stable'
   state: present


 name: Install telegraf
 apt:
   name: telegraf
   state: latest
   update_cache: yes


 name: Start telegraf
 service:
   name: telegraf
   state: started

 
